<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    * { box-sizing:border-box; }

    body {
        background:#FFEFF7;
        font-family:-apple-system,BlinkMacSystemFont,"Pretendard",system-ui,sans-serif;
        margin:0; padding:16px; color:#4b2e3d;
    }

    h1 {
        text-align:center; color:#ff6fa8;
        margin:0 0 6px 0; font-size:22px;
    }

    .tag {
        text-align:center; font-size:12px; color:#fff;
        background:#ff9ac5; padding:4px 12px;
        border-radius:999px; display:inline-block;
        margin-left:50%; transform:translateX(-50%);
        margin-bottom:18px;
    }

    .card {
        background:#ffffff; padding:12px;
        border-radius:14px; box-shadow:0 3px 12px rgba(255,140,170,0.22);
        margin-bottom:16px;
    }

    .section-title {
        font-size:15px; font-weight:700;
        margin-bottom:8px; color:#ff6fa8;
    }

    textarea {
        width:100%; min-height:70px;
        border-radius:10px; border:1px solid #ffc9dd;
        padding:8px; resize:vertical;
        font-family:inherit; font-size:13px;
        background:#fffafd;
    }

    button {
        padding:8px 14px; border:none;
        border-radius:999px; background:#ff6fa8;
        color:white; font-weight:600;
        cursor:pointer; font-size:13px;
    }

    button:active { transform:translateY(1px); }

    /* Space Card */
    .space-card {
        margin-bottom:12px; padding:12px;
        border-radius:12px; background:#fffdfb;
        border:1px solid #ffd3e3;
        box-shadow:0 2px 6px rgba(0,0,0,0.03);
    }

    .space-header {
        display:flex; justify-content:space-between;
        align-items:center; margin-bottom:6px; gap:6px;
    }

    .space-main { display:flex; flex-direction:column; gap:6px; }

    .badge-nick {
        font-size:13px; font-weight:600;
        padding:4px 10px; border-radius:999px;
        background:#ffdbea; color:#af5579;
    }

    .badge-id {
        font-size:11px; padding:4px 8px;
        border-radius:999px; background:#fff2f7;
        color:#b05a7d; display:inline-flex;
        align-items:center; gap:4px;
    }

    .badge-id button {
        padding:2px 6px; font-size:10px;
        border-radius:999px; background:#ff8fb8; color:#fff;
    }

    .space-fields { display:flex; flex-wrap:wrap; gap:6px; }

    .field-chip {
        display:inline-flex; align-items:center; gap:4px;
        padding:4px 8px; border-radius:999px;
        background:#ffe6f0; font-size:11px;
    }

    .field-chip input[type="checkbox"] {
        width:16px; height:16px; accent-color:#ff6fa8; margin:0;
    }

    .input-small-label {
        font-size:12px; color:#b06b8d;
        margin:6px 0 4px 0;
    }

    .space-memo textarea {
        min-height:50px; font-size:12px;
    }

    @media(min-width:720px){
        body{ max-width:640px; margin:0 auto; }
    }
</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</div>

    <div class="input-small-label">ğŸ¥• ê´€ë¦¬ì â†’ ì‚¬ìš©ì</div>
    <div id="adminMessageBox"
         style="white-space:pre-line; padding:8px; border-radius:10px; border:1px solid #ffcddd; background:#fff8fb; font-size:13px;">
         (ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤)
    </div>

    <div class="input-small-label" style="margin-top:12px;">ğŸ° ì‚¬ìš©ì â†’ ê´€ë¦¬ì</div>
    <textarea id="userMessage" placeholder="ì˜¤ëŠ˜ í•˜ê³  ì‹¶ì€ ë§ ì ê¸°"></textarea>
    <div style="margin-top:6px; text-align:right;">
        <button onclick="saveUserMessage()">ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥</button>
    </div>
</div>

<!-- ìˆ™ì œ ì¹´ë“œ ëª©ë¡ -->
<div class="card">
    <div class="section-title">ğŸ“¦ ë‚´ ìˆ™ì œ ì²´í¬</div>
    <div id="spacesContainer"></div>
</div>

<script>
/* Firebase ì´ˆê¸°í™” */
const firebaseConfig = {
    apiKey:"AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain:"daily-checklist-91e5a.firebaseapp.com",
    projectId:"daily-checklist-91e5a",
    storageBucket:"daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId:"66394691958",
    appId:"1:66394691958:web:cf91f295456a2e10d18257",
    measurementId:"G-87WK4N4EGH"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const todayMessagesRef = db.collection("today").doc("messages");
const configRef = db.collection("config").doc("checklist");
const spacesRef = db.collection("spaces");

/* ìƒíƒœ */
let fields = [];
let spacesData = [];

/* ê´€ë¦¬ì ë©”ì‹œì§€ */
todayMessagesRef.onSnapshot(doc=>{
    if(doc.exists){
        document.getElementById("adminMessageBox").innerText =
            doc.data().adminMessage || "(ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤)";
        document.getElementById("userMessage").value =
            doc.data().userMessage || "";
    }
});

/* ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥ */
function saveUserMessage(){
    const msg = document.getElementById("userMessage").value;
    todayMessagesRef.set({
        userMessage: msg,
        date: new Date().toISOString()
    },{merge:true});
    alert("ë©”ì‹œì§€ë¥¼ ì „ì†¡í–ˆì–´ìš”!");
}

/* í•­ëª© ë¡œë“œ */
configRef.onSnapshot(doc=>{
    if(doc.exists){
        fields = doc.data().fields || [];
        renderSpaces();
    }
});

/* ìœ ì € ëŒ€ìƒ ë¡œë“œ */
spacesRef.onSnapshot(snapshot=>{
    spacesData = snapshot.docs.map(d=>({ id:d.id, ...d.data() }));
    renderSpaces();
});

/* ì²´í¬ì—…ë°ì´íŠ¸ */
function updateCheck(docId, field, val){
    spacesRef.doc(docId).update({
        ["checks."+field]: val
    });
}

/* ë©”ëª¨ ì—…ë°ì´íŠ¸ */
function updateMemo(docId, val){
    spacesRef.doc(docId).update({ memo:val });
}

/* ID ë³µì‚¬ ê¸°ëŠ¥ */
function copyUserId(value){
    if(!value) return;
    navigator.clipboard.writeText(value)
        .then(()=>alert("ì•„ì´ë”” ë³µì‚¬ë¨: "+value));
}

/* ì¹´ë“œ ë Œë” */
function renderSpaces(){
    const container = document.getElementById("spacesContainer");
    container.innerHTML = "";

    if(!spacesData.length){
        container.innerHTML = "<div>ì•„ì§ ì¶”ê°€ëœ ìˆ™ì œ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>";
        return;
    }

    spacesData.forEach(item=>{
        const checks = item.checks || {};

        const card = document.createElement("div");
        card.className = "space-card";

        card.innerHTML = `
            <div class="space-header">
                <div class="space-main">
                    <div class="badge-nick">ë‹‰ë„¤ì„: ${item.nickname}</div>
                    <div class="badge-id">
                        <span>ì•„ì´ë””: ${item.userid}</span>
                        <button onclick="copyUserId('${item.userid}')">ë³µì‚¬</button>
                    </div>
                </div>
            </div>

            <div class="space-fields">
                ${fields.map(f=>`
                    <div class="field-chip">
                        <input type="checkbox"
                             ${checks[f]?"checked":""}
                             onchange="updateCheck('${item.id}','${f}',this.checked)">
                        <span>${f}</span>
                    </div>
                `).join("")}
            </div>

            <div class="input-small-label">ë©”ëª¨</div>
            <textarea onchange="updateMemo('${item.id}',this.value)">${item.memo||""}</textarea>
        `;

        container.appendChild(card);
    });
}
</script>

</body>
</html>
