<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box;}

body{
    margin:0;
    padding:16px;
    background:#ffe7f3;
    font-family:-apple-system,BlinkMacSystemFont,"Pretendard",system-ui,sans-serif;
    color:#5a3050;
}

h1{
    text-align:center;
    color:#ff4fa0;
    margin:0 0 6px;
    font-size:22px;
}

.tag{
    display:inline-block;
    margin:0 auto 18px;
    padding:4px 12px;
    border-radius:999px;
    background:#ff9acb;
    color:#fff;
    font-size:12px;
    position:relative;
    left:50%;
    transform:translateX(-50%);
}

.card{
    background:#ffffff;
    border-radius:18px;
    padding:16px;
    margin:0 auto 18px;
    box-shadow:0 3px 10px rgba(255,120,190,0.18);
    max-width:480px;
}

.section-title{
    font-size:16px;
    font-weight:700;
    color:#ff4fa0;
    margin-bottom:8px;
    display:flex;
    align-items:center;
    gap:6px;
}

.section-title .sub{
    font-size:12px;
    font-weight:400;
    color:#b96292;
}

.small-helper{
    font-size:11px;
    color:#b2628f;
    margin-bottom:6px;
}

textarea{
    width:100%;
    min-height:70px;
    border-radius:12px;
    border:1px solid #ffb3d9;
    padding:8px;
    font-family:inherit;
    font-size:13px;
    resize:vertical;
    background:#fff8fc;
}

button{
    border:none;
    padding:8px 16px;
    border-radius:999px;
    font-size:13px;
    font-weight:600;
    cursor:pointer;
}

.btn-main{
    background:#ff4fa0;
    color:#fff;
}

.btn-sub{
    background:#ffd0eb;
    color:#b2447e;
}

/* ìš”ì•½ 3x3 */

.summary-wrapper{
    max-width:420px;
    margin:0 auto;
}

.summary-grid{
    display:grid;
    grid-template-columns:repeat(3,minmax(0,1fr));
    gap:10px;
}

.summary-chip{
    background:#ffd7f0;
    border-radius:14px;
    padding:8px 6px;
    text-align:center;
}

.summary-chip label{
    display:block;
    font-size:13px;
    color:#a14477;
    margin-bottom:3px;
}

.summary-chip input{
    width:70px;
    max-width:100%;
    padding:4px 6px;
    text-align:center;
    border-radius:12px;
    border:1px solid #ffb3d9;
    font-size:16px;
    background:#fff8fc;
}

/* ìˆ™ì œ ì¹´ë“œ */

.cards-container{
    max-width:480px;
    margin:0 auto;
}

.homework-card{
    background:#fff3fa;
    border-radius:20px;
    padding:16px 14px 18px;
    margin-bottom:14px;
    border:1px solid #ffc0e4;
}

.hw-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    margin-bottom:10px;
    flex-wrap:wrap;
}

.hw-nick{
    padding:6px 12px;
    border-radius:999px;
    background:#ffc2e4;
    color:#7f2c5a;
    font-size:13px;
    font-weight:600;
}

.hw-id-line{
    display:flex;
    align-items:center;
    gap:6px;
    font-size:11px;
    color:#a34473;
    margin-bottom:8px;
}

.id-badge{
    padding:4px 8px;
    border-radius:999px;
    background:#ffe4f4;
}

.id-copy{
    padding:4px 10px;
    border-radius:999px;
    background:#ff9acb;
    color:#fff;
    font-size:11px;
}

.hw-done{
    margin-left:auto;
    background:#ff4fa0;
    color:#fff;
    border-radius:999px;
    padding:8px 18px;
    font-size:13px;
    font-weight:700;
}

.hw-grid{
    display:grid;
    grid-template-columns:repeat(3,minmax(0,1fr));
    gap:10px;
    margin:6px 0 12px;
}

.hw-chip{
    background:#ffd7f0;
    border-radius:14px;
    padding:8px 6px;
    text-align:center;
}

.hw-chip label{
    font-size:13px;
    color:#a14477;
    margin-bottom:3px;
    display:block;
}

.hw-chip input{
    width:70px;
    max-width:100%;
    padding:4px 6px;
    text-align:center;
    border-radius:12px;
    border:1px solid #ffb3d9;
    font-size:16px;
    background:#fff8fc;
}

/* ë©”ëª¨ + í’ì„  */

.hw-bottom{
    display:flex;
    gap:10px;
    margin-top:6px;
}

.hw-memo-wrap{
    flex:3;
}

.hw-balloon-wrap{
    flex:1.2;
}

.hw-memo-wrap label,
.hw-balloon-wrap label{
    display:block;
    font-size:12px;
    color:#8a4069;
    margin-bottom:4px;
}

.hw-memo{
    width:100%;
    height:90px;
    border-radius:12px;
    border:1px solid #ffb3d9;
    padding:8px;
    resize:vertical;
    font-size:13px;
    background:#fff8fc;
}

.hw-balloon{
    width:100%;
    height:90px;
    border-radius:12px;
    border:1px solid #ffb3d9;
    padding:8px;
    font-size:18px;
    text-align:center;
    background:#fff8fc;
}

@media (max-width:480px){
    .card{
        padding:14px;
    }
    .hw-grid .hw-chip input,
    .summary-chip input{
        width:60px;
        font-size:15px;
    }
}
</style>
</head>
<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” <span class="sub">(ê´€ë¦¬ì â†” ì‚¬ìš©ì)</span></div>

    <div class="small-helper">ğŸ¥• ê´€ë¦¬ì â†’ ë‚­</div>
    <div id="adminMessageBox"
         style="white-space:pre-line;padding:8px;border-radius:12px;border:1px solid #ffc6e1;background:#fff8fc;font-size:13px;">
        (ì•„ì§ ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
    </div>

    <div style="height:10px;"></div>

    <div class="small-helper">ğŸ° ë‚­ â†’ ê´€ë¦¬ì</div>
    <textarea id="userMessage" placeholder="ì˜¤ëŠ˜ í•˜ê³  ì‹¶ì€ ë§ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>

    <div style="margin-top:8px;text-align:right;">
        <button class="btn-main" onclick="saveUserMessage()">ì €ì¥</button>
    </div>
</div>

<!-- ì˜¤ëŠ˜ ìˆ™ì œ -->
<div class="card summary-wrapper">
    <div class="section-title">ğŸ“¦ <span id="todayTitle"></span> ìˆ™ì œ</div>
    <div class="small-helper">ì˜¤ëŠ˜ í•´ì•¼ í•  ìˆ™ì œ ìˆ«ìë¥¼ ì ì–´ ì£¼ì„¸ìš”. í•©ê³„(ë°°+ì—­, ì›€+ì‚¬)ëŠ” ì €ì¥ ì‹œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>

    <div class="summary-grid">
        <div class="summary-chip">
            <label>ë°°ë¯¼</label>
            <input type="number" id="today-ë°°ë¯¼" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ë°©ì…€</label>
            <input type="number" id="today-ë°©ì…€" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì›€ì§¤</label>
            <input type="number" id="today-ì›€ì§¤" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì—­íŒ¬</label>
            <input type="number" id="today-ì—­íŒ¬" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì •ì„±</label>
            <input type="number" id="today-ì •ì„±" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì‚¬ì§„</label>
            <input type="number" id="today-ì‚¬ì§„" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>í•©ê³„(ë°°+ì—­)</label>
            <input type="number" id="today-í•©ë°°ì—­" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì˜ìƒ</label>
            <input type="number" id="today-ì˜ìƒ" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>í•©ê³„(ì›€+ì‚¬)</label>
            <input type="number" id="today-í•©ì›€ì‚¬" min="0" value="0">
        </div>
    </div>

    <div style="margin-top:10px;text-align:right;">
        <button class="btn-sub" onclick="saveSummary('today')">ì˜¤ëŠ˜ ìˆ™ì œ ì €ì¥</button>
    </div>
</div>

<!-- ë°€ë¦° ìˆ™ì œ -->
<div class="card summary-wrapper">
    <div class="section-title">ğŸ“¦ ë°€ë¦° ìˆ™ì œ</div>
    <div class="small-helper">ë°€ë ¤ ìˆëŠ” ìˆ™ì œ ìˆ«ìë¥¼ ì ì–´ ì£¼ì„¸ìš”. í•©ê³„(ë°°+ì—­, ì›€+ì‚¬)ëŠ” ì €ì¥ ì‹œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>

    <div class="summary-grid">
        <div class="summary-chip">
            <label>ë°°ë¯¼</label>
            <input type="number" id="back-ë°°ë¯¼" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ë°©ì…€</label>
            <input type="number" id="back-ë°©ì…€" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì›€ì§¤</label>
            <input type="number" id="back-ì›€ì§¤" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì—­íŒ¬</label>
            <input type="number" id="back-ì—­íŒ¬" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì •ì„±</label>
            <input type="number" id="back-ì •ì„±" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì‚¬ì§„</label>
            <input type="number" id="back-ì‚¬ì§„" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>í•©ê³„(ë°°+ì—­)</label>
            <input type="number" id="back-í•©ë°°ì—­" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>ì˜ìƒ</label>
            <input type="number" id="back-ì˜ìƒ" min="0" value="0">
        </div>
        <div class="summary-chip">
            <label>í•©ê³„(ì›€+ì‚¬)</label>
            <input type="number" id="back-í•©ì›€ì‚¬" min="0" value="0">
        </div>
    </div>

    <div style="margin-top:10px;text-align:right;">
        <button class="btn-sub" onclick="saveSummary('back')">ë°€ë¦° ìˆ™ì œ ì €ì¥</button>
    </div>
</div>

<!-- ìˆ™ì œ ì¹´ë“œ -->
<div class="card cards-container">
    <div class="section-title">ğŸ“‹ ìˆ™ì œ ì¹´ë“œ</div>
    <div class="small-helper">ê´€ë¦¬ìê°€ ë§Œë“¤ì–´ ì¤€ ì¹´ë“œì…ë‹ˆë‹¤. ê° í•­ëª©ì˜ ìˆ«ìì™€ ë©”ëª¨, í’ì„  ê°¯ìˆ˜ë¥¼ ì±„ìš´ ë’¤ ë‹¤ ëë‚˜ë©´ â€˜ì™„ë£Œ ğŸ°â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</div>

    <div id="cardsContainer"></div>
</div>

<script>
const firebaseConfig={
    apiKey:"AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain:"daily-checklist-91e5a.firebaseapp.com",
    projectId:"daily-checklist-91e5a",
    storageBucket:"daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId:"66394691958",
    appId:"1:66394691958:web:cf91f295456a2e10d18257",
    measurementId:"G-87WK4N4EGH"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* refs (ê´€ë¦¬ìì™€ ë™ì¼í•œ ìœ„ì¹˜ ì‚¬ìš©) */
const todayMessagesRef=db.collection("today").doc("messages");
const summaryTodayRef=db.collection("summary").doc("today");
const summaryBackRef=db.collection("summary").doc("backlog");
const cardsRef=db.collection("cards");

/* ë‚ ì§œ ì œëª© */
(function(){
    const now=new Date();
    const m=now.getMonth()+1;
    const d=now.getDate();
    const w=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][now.getDay()];
    document.getElementById("todayTitle").innerText=`${m}ì›” ${d}ì¼(${w})`;
})();

/* í•œë§ˆë”” (ê´€ë¦¬ìâ†’ìœ ì € / ìœ ì €â†’ê´€ë¦¬ì) */
todayMessagesRef.onSnapshot(doc=>{
    if(!doc.exists){
        todayMessagesRef.set({
            adminMessage:"",
            userMessage:"",
            date:new Date().toISOString()
        },{merge:true});
        return;
    }
    const data=doc.data();
    document.getElementById("adminMessageBox").innerText=data.adminMessage||"(ì•„ì§ ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)";
    document.getElementById("userMessage").value=data.userMessage||"";
});

function saveUserMessage(){
    const msg=document.getElementById("userMessage").value;
    todayMessagesRef.set({
        userMessage:msg,
        date:new Date().toISOString()
    },{merge:true}).then(()=>alert("ë©”ì‹œì§€ë¥¼ ì €ì¥í–ˆì–´ìš”."));
}

/* ìš”ì•½ ë¡œë“œ/ì €ì¥ (ê´€ë¦¬ìì™€ ë™ì¼ ë¬¸ì„œ ê³µìœ ) */

const fieldsOrder=["ë°°ë¯¼","ë°©ì…€","ì›€ì§¤","ì—­íŒ¬","ì •ì„±","ì‚¬ì§„","í•©ë°°ì—­","ì˜ìƒ","í•©ì›€ì‚¬"];

summaryTodayRef.onSnapshot(doc=>{
    const d=doc.exists?doc.data():{};
    setSummaryInputs("today",d);
});
summaryBackRef.onSnapshot(doc=>{
    const d=doc.exists?doc.data():{};
    setSummaryInputs("back",d);
});

function setSummaryInputs(prefix,data){
    fieldsOrder.forEach(k=>{
        const el=document.getElementById(prefix+"-"+k);
        if(el) el.value=data[k] ?? 0;
    });
}

function readSummary(prefix){
    const obj={};
    fieldsOrder.forEach(k=>{
        const el=document.getElementById(prefix+"-"+k);
        obj[k]=Number(el.value||0);
    });
    obj["í•©ë°°ì—­"]=obj["ë°°ë¯¼"]+obj["ì—­íŒ¬"];
    obj["í•©ì›€ì‚¬"]=obj["ì›€ì§¤"]+obj["ì‚¬ì§„"];
    return obj;
}

function saveSummary(which){
    const prefix=which==="today"?"today":"back";
    const obj=readSummary(prefix);
    obj.updatedAt=new Date().toISOString();
    const ref=which==="today"?summaryTodayRef:summaryBackRef;
    ref.set(obj,{merge:true}).then(()=>{
        alert(which==="today"?"ì˜¤ëŠ˜ ìˆ™ì œë¥¼ ì €ì¥í–ˆì–´ìš”.":"ë°€ë¦° ìˆ™ì œë¥¼ ì €ì¥í–ˆì–´ìš”.");
    });
}

/* ìˆ™ì œ ì¹´ë“œ (ê´€ë¦¬ìì™€ ë™ì¼ cards ì»¬ë ‰ì…˜) */

cardsRef.orderBy("nickname").onSnapshot(snap=>{
    const list=[];
    snap.forEach(doc=>list.push({id:doc.id,...doc.data()}));
    renderCards(list);
});

function copyText(t){
    if(!t) return;
    navigator.clipboard?.writeText(t).then(()=>alert("ë³µì‚¬ë¨: "+t));
}

function updateCard(id,field,value){
    cardsRef.doc(id).update({[field]:value});
}
function updateCardCount(id,field,value){
    cardsRef.doc(id).update({["counts."+field]:value});
}
function completeCard(id){
    if(!confirm("ì´ ì¹´ë“œë¥¼ ì •ë§ ì™„ë£Œ ì²˜ë¦¬í• ê¹Œìš”?")) return;
    cardsRef.doc(id).delete();
}

function renderCards(cards){
    const wrap=document.getElementById("cardsContainer");
    wrap.innerHTML="";
    if(!cards.length){
        wrap.innerHTML='<div class="small-helper">ì•„ì§ ìˆ™ì œ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìê°€ ì¶”ê°€í•´ ì¤„ ê±°ì˜ˆìš”.</div>';
        return;
    }
    cards.forEach(c=>{
        const counts=c.counts||{};
        const div=document.createElement("div");
        div.className="homework-card";
        div.innerHTML=`
            <div class="hw-header">
                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
                    <div class="hw-nick">ë‹‰ë„¤ì„: ${c.nickname||""}</div>
                </div>
                <button class="hw-done" onclick="completeCard('${c.id}')">ì™„ë£Œ ğŸ°</button>
            </div>
            <div class="hw-id-line">
                <span class="id-badge">ì•„ì´ë””: ${c.userid||""}</span>
                <button class="id-copy" onclick="copyText('${c.userid||""}')">ë³µì‚¬</button>
            </div>
            <div class="hw-grid">
                ${["ì—­íŒ¬","ë°°ë¯¼","ì •ì„±","ì˜ìƒ","ë°©ì…€"].map(name=>`
                    <div class="hw-chip">
                        <label>${name}</label>
                        <input type="number" min="0" value="${counts[name]??0}"
                           onchange="updateCardCount('${c.id}','${name}',Number(this.value||0))">
                    </div>
                `).join("")}
            </div>
            <div class="hw-bottom">
                <div class="hw-memo-wrap">
                    <label>ë©”ëª¨</label>
                    <textarea class="hw-memo" onchange="updateCard('${c.id}','memo',this.value)">${c.memo||""}</textarea>
                </div>
                <div class="hw-balloon-wrap">
                    <label>í’ì„ </label>
                    <input type="number" class="hw-balloon" min="0"
                        value="${c.balloon ?? 0}"
                        onchange="updateCard('${c.id}','balloon',Number(this.value||0))">
                </div>
            </div>
        `;
        wrap.appendChild(div);
    });
}
</script>
</body>
</html>
