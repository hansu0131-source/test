<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
  * { box-sizing: border-box; }

  body {
    background: #fff5e8;
    font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
    margin: 0;
    padding: 16px;
    color: #4b3525;
  }

  h1 {
    text-align: center;
    color: #ff8a3c;
    margin: 0 0 6px 0;
    font-size: 22px;
  }

  .tag {
    text-align: center;
    font-size: 12px;
    color: #fff;
    background: #ffb37a;
    padding: 4px 12px;
    border-radius: 999px;
    display: inline-block;
    margin-left: 50%;
    transform: translateX(-50%);
    margin-bottom: 18px;
  }

  .card {
    background: #ffffff;
    padding: 12px;
    border-radius: 14px;
    box-shadow: 0 3px 10px rgba(255, 150, 95, 0.22);
    margin-bottom: 16px;
  }

  .section-title {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 6px;
    color: #ff8a3c;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .section-title .sub {
    font-size: 12px;
    font-weight: 400;
    color: #b07b55;
  }

  .helper {
    font-size: 11px;
    color: #9a6c4b;
    margin-bottom: 6px;
  }

  textarea {
    width: 100%;
    min-height: 70px;
    border-radius: 10px;
    border: 1px solid #ffcfac;
    padding: 8px;
    resize: vertical;
    font-family: inherit;
    font-size: 13px;
    background: #fffdfa;
  }

  button {
    padding: 8px 14px;
    border: none;
    border-radius: 999px;
    background: #ff8a3c;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    font-size: 13px;
  }

  button:active { transform: translateY(1px); }

  .btn-sub {
    background: #ffd2ae;
    color: #9f4e23;
  }
  .btn-danger {
    background: #ffebe1;
    color: #ff5c37;
  }

  .input-small-label {
    font-size: 12px;
    color: #79533a;
    margin-bottom: 4px;
  }

  /* ==== 3x3 ìš”ì•½ ê·¸ë¦¬ë“œ ==== */
  .summary-wrapper {
    display: flex;
    justify-content: center;
  }

  .summary-grid {
    width: 100%;
    max-width: 420px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 8px;
  }

  .summary-box {
    background: #ffe1d0;
    border-radius: 14px;
    padding: 6px 6px 10px;
    text-align: center;
  }

  .summary-label {
    font-size: 12px;
    font-weight: 600;
    color: #a65730;
    margin-bottom: 4px;
  }

  .summary-input {
    width: 100%;
    max-width: 80px;
    margin: 0 auto;
    padding: 4px 0;
    border-radius: 999px;
    border: 1px solid #ffbfa0;
    background: #fff7f1;
    text-align: center;
    font-size: 13px;
  }

  /* ==== ì˜¤ëŠ˜/ë°€ë¦° íƒ€ì´í‹€ ë¼ì¸ ==== */
  .row-header {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 4px;
  }
  .row-header-icon {
    font-size: 16px;
  }
  .row-header-title {
    font-size: 14px;
    font-weight: 700;
    color: #e36a2c;
  }

  .right-align {
    text-align: right;
    margin-top: 8px;
  }

  .input-line {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
  }

  .input-line input[type="text"] {
    flex: 1;
    min-width: 0;
    padding: 7px;
    border-radius: 9px;
    border: 1px solid #ffd1a4;
    font-size: 13px;
    background: #fffdfa;
  }

  /* ==== ìˆ™ì œ ì¹´ë“œ ==== */
  .cards-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .homework-card {
    background: #fff9f5;
    border-radius: 16px;
    border: 1px solid #ffe0c5;
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    padding: 10px;
  }

  .card-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
  }

  .card-name-area {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .badge-nick {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    background: #ffe0c2;
    color: #8b4b20;
    font-size: 13px;
    font-weight: 600;
  }

  .badge-id {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    border-radius: 999px;
    background: #fff2df;
    color: #a85a23;
    font-size: 11px;
  }

  .badge-id button {
    padding: 2px 6px;
    font-size: 10px;
    background: #ffb37a;
    color: #fff;
    border-radius: 999px;
  }

  .btn-complete {
    background: #ff7f5a;
    min-width: 70px;
  }

  .btn-complete span {
    margin-left: 2px;
  }

  .card-stats-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0,1fr));
    grid-gap: 8px;
    margin-bottom: 8px;
  }

  /* ë§ˆì§€ë§‰ ë°©ì…€ì€ í•œ ì¤„ ì „ì²´ ì‚¬ìš© */
  .card-stats-grid .full {
    grid-column: 1 / -1;
  }

  .card-stat-box {
    background: #ffe7d5;
    border-radius: 14px;
    padding: 6px 6px 10px;
    text-align: center;
  }

  .card-stat-label {
    font-size: 12px;
    font-weight: 600;
    color: #a65730;
    margin-bottom: 4px;
  }

  .card-stat-input {
    width: 100%;
    max-width: 70px;
    margin: 0 auto;
    padding: 4px 0;
    border-radius: 999px;
    border: 1px solid #ffbfa0;
    background: #fff7f1;
    text-align: center;
    font-size: 13px;
  }

  .card-bottom-row {
    display: flex;
    gap: 8px;
    margin-top: 4px;
    flex-wrap: wrap;
  }

  .card-bottom-column {
    flex: 1;
    min-width: 0;
  }

  .card-bottom-column textarea {
    min-height: 70px;
    font-size: 12px;
  }

  .card-label-small {
    font-size: 12px;
    color: #8b5433;
    margin-bottom: 4px;
  }

  .empty-text {
    font-size: 12px;
    color: #aa7c5b;
    margin-top: 2px;
  }

  @media (max-width: 480px) {
    .card-stats-grid {
      grid-template-columns: repeat(3, minmax(0,1fr));
    }
    .card-stats-grid .full {
      grid-column: 1 / -1;
    }
  }

  @media (min-width: 720px) {
    body {
      max-width: 640px;
      margin: 0 auto;
    }
  }
</style>
</head>

<body>
<h1>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</h1>
<div class="tag">ê´€ë¦¬ì ID: ë‹¹ (ì£¼í™©)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
  <div class="section-title">
    ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë””
    <span class="sub">(ê´€ë¦¬ì â†” ì‚¬ìš©ì)</span>
  </div>

  <div class="input-small-label">ğŸ¥• ê´€ë¦¬ì â†’ ì‚¬ìš©ì</div>
  <textarea id="adminMessage" placeholder="ë‚­ì—ê²Œ ì˜¤ëŠ˜ ì „í•˜ê³  ì‹¶ì€ ë§"></textarea>
  <div class="right-align">
    <button onclick="saveAdminMessage()">ê´€ë¦¬ì í•œë§ˆë”” ì €ì¥</button>
  </div>

  <div style="height:10px;"></div>

  <div class="input-small-label">ğŸ° ì‚¬ìš©ì â†’ ê´€ë¦¬ì</div>
  <div id="userMessageBox"
       style="white-space:pre-line; padding:8px; border-radius:10px; border:1px solid #ffd7c2; background:#fff8f3; font-size:13px;">
    (ì•„ì§ ì‚¬ìš©ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
  </div>
</div>

<!-- ì˜¤ëŠ˜ ìˆ™ì œ -->
<div class="card">
  <div class="row-header">
    <div class="row-header-icon">ğŸ“¦</div>
    <div class="row-header-title" id="todayTitle">ì˜¤ëŠ˜ ìˆ™ì œ</div>
  </div>
  <div class="helper">ì˜¤ëŠ˜ í•´ì•¼ í•  ìˆ™ì œ ìˆ«ìë¥¼ ì ì–´ ì£¼ì„¸ìš”. í•©ê³„(ë°°+ì—­, ì›€+ì‚¬)ëŠ” ì €ì¥ ì‹œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>

  <div class="summary-wrapper">
    <div class="summary-grid">
      <!-- 1í–‰ -->
      <div class="summary-box">
        <div class="summary-label">ë°°ë¯¼</div>
        <input id="today-ë°°ë¯¼" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ë°©ì…€</div>
        <input id="today-ë°©ì…€" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì›€ì§¤</div>
        <input id="today-ì›€ì§¤" type="number" class="summary-input" min="0" value="0">
      </div>

      <!-- 2í–‰ -->
      <div class="summary-box">
        <div class="summary-label">ì—­íŒ¬</div>
        <input id="today-ì—­íŒ¬" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì •ì„±</div>
        <input id="today-ì •ì„±" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì‚¬ì§„</div>
        <input id="today-ì‚¬ì§„" type="number" class="summary-input" min="0" value="0">
      </div>

      <!-- 3í–‰ -->
      <div class="summary-box">
        <div class="summary-label">í•©ê³„(ë°°+ì—­)</div>
        <input id="today-í•©ê³„_ë°°ì—­" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì˜ìƒ</div>
        <input id="today-ì˜ìƒ" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">í•©ê³„(ì›€+ì‚¬)</div>
        <input id="today-í•©ê³„_ì›€ì‚¬" type="number" class="summary-input" min="0" value="0">
      </div>
    </div>
  </div>

  <div class="right-align">
    <button class="btn-sub" onclick="saveSummary('today')">ì˜¤ëŠ˜ ìˆ™ì œ ì €ì¥</button>
  </div>
</div>

<!-- ë°€ë¦° ìˆ™ì œ -->
<div class="card">
  <div class="row-header">
    <div class="row-header-icon">ğŸ“¦</div>
    <div class="row-header-title">ë°€ë¦° ìˆ™ì œ</div>
  </div>
  <div class="helper">ë°€ë ¤ ìˆëŠ” ìˆ™ì œ ìˆ«ìë¥¼ ì ì–´ ì£¼ì„¸ìš”. í•©ê³„(ë°°+ì—­, ì›€+ì‚¬)ëŠ” ì €ì¥ ì‹œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>

  <div class="summary-wrapper">
    <div class="summary-grid">
      <!-- 1í–‰ -->
      <div class="summary-box">
        <div class="summary-label">ë°°ë¯¼</div>
        <input id="backlog-ë°°ë¯¼" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ë°©ì…€</div>
        <input id="backlog-ë°©ì…€" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì›€ì§¤</div>
        <input id="backlog-ì›€ì§¤" type="number" class="summary-input" min="0" value="0">
      </div>

      <!-- 2í–‰ -->
      <div class="summary-box">
        <div class="summary-label">ì—­íŒ¬</div>
        <input id="backlog-ì—­íŒ¬" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì •ì„±</div>
        <input id="backlog-ì •ì„±" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì‚¬ì§„</div>
        <input id="backlog-ì‚¬ì§„" type="number" class="summary-input" min="0" value="0">
      </div>

      <!-- 3í–‰ -->
      <div class="summary-box">
        <div class="summary-label">í•©ê³„(ë°°+ì—­)</div>
        <input id="backlog-í•©ê³„_ë°°ì—­" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">ì˜ìƒ</div>
        <input id="backlog-ì˜ìƒ" type="number" class="summary-input" min="0" value="0">
      </div>
      <div class="summary-box">
        <div class="summary-label">í•©ê³„(ì›€+ì‚¬)</div>
        <input id="backlog-í•©ê³„_ì›€ì‚¬" type="number" class="summary-input" min="0" value="0">
      </div>
    </div>
  </div>

  <div class="right-align">
    <button class="btn-sub" onclick="saveSummary('backlog')">ë°€ë¦° ìˆ™ì œ ì €ì¥</button>
  </div>
</div>

<!-- ìˆ™ì œ ì¹´ë“œ ì¶”ê°€ -->
<div class="card">
  <div class="section-title">ğŸ“‹ ìˆ™ì œ ì¹´ë“œ ì¶”ê°€</div>
  <div class="helper">ë‹‰ë„¤ì„ê³¼ ì•„ì´ë””ë¥¼ ì ê³  ìƒˆ ìˆ™ì œ ì¹´ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.</div>
  <div class="input-line">
    <input id="newNick" type="text" placeholder="ë‹‰ë„¤ì„">
    <input id="newID" type="text" placeholder="ì•„ì´ë””">
    <button onclick="addCard()">ì¶”ê°€</button>
  </div>
</div>

<!-- ìˆ™ì œ ì¹´ë“œ ëª©ë¡ -->
<div class="card">
  <div class="section-title">ğŸ“ ìˆ™ì œ ì¹´ë“œ</div>
  <div class="helper">ê´€ë¦¬ìê°€ ë§Œë“¤ì–´ ì¤€ ì¹´ë“œì…ë‹ˆë‹¤. ê° í•­ëª©ì˜ ìˆ«ìì™€ ë©”ëª¨, í’ì„  ë‚´ìš©ì„ ì±„ìš´ ë’¤ ëª¨ë‘ ëë‚œ ì¹´ë“œëŠ”
    <b>ì™„ë£Œ ğŸ°</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ë¦¬í•´ ì£¼ì„¸ìš”.</div>
  <div id="cardsContainer" class="cards-container"></div>
</div>

<script>
  // ===== Firebase init =====
  const firebaseConfig = {
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
    storageBucket: "daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId: "66394691958",
    appId: "1:66394691958:web:cf91f295456a2e10d18257",
    measurementId: "G-87WK4N4EGH"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ===== Firestore refs =====
  const todayMessagesRef = db.collection("today").doc("messages");
  const summaryTodayRef  = db.collection("summary").doc("today");
  const summaryBacklogRef = db.collection("summary").doc("backlog");
  const cardsRef = db.collection("cards");

  const SUMMARY_FIELDS = [
    "ë°°ë¯¼","ë°©ì…€","ì›€ì§¤",
    "ì—­íŒ¬","ì •ì„±","ì‚¬ì§„",
    "í•©ê³„_ë°°ì—­","ì˜ìƒ","í•©ê³„_ì›€ì‚¬"
  ];

  // ===== ì˜¤ëŠ˜ ë‚ ì§œ ë¼ë²¨ =====
  function setTodayLabel() {
    const now = new Date();
    const m = now.getMonth() + 1;
    const d = now.getDate();
    const wNames = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
    const w = wNames[now.getDay()];
    document.getElementById("todayTitle").innerText = `ğŸ“¦ ${m}ì›” ${d}ì¼(${w}) ìˆ™ì œ`;
  }

  // ===== ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ì‹¤ì‹œê°„ =====
  todayMessagesRef.onSnapshot(doc => {
    if (!doc.exists) {
      todayMessagesRef.set({
        adminMessage: "",
        userMessage: "",
        date: new Date().toISOString()
      }, { merge: true });
      return;
    }
    const data = doc.data();
    document.getElementById("adminMessage").value = data.adminMessage || "";
    document.getElementById("userMessageBox").innerText =
      data.userMessage || "(ì•„ì§ ì‚¬ìš©ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)";
  });

  function saveAdminMessage() {
    const msg = document.getElementById("adminMessage").value || "";
    todayMessagesRef.set({
      adminMessage: msg,
      date: new Date().toISOString()
    }, { merge: true })
    .then(() => alert("ê´€ë¦¬ì í•œë§ˆë””ë¥¼ ì €ì¥í–ˆì–´ìš”."))
    .catch(err => {
      console.error(err);
      alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
    });
  }

  // ===== ìš”ì•½ ì‹¤ì‹œê°„ ë¡œë“œ =====
  summaryTodayRef.onSnapshot(doc => {
    if (!doc.exists) {
      summaryTodayRef.set(makeEmptySummary(), { merge: true });
      return;
    }
    applySummaryToUI("today", doc.data());
  });

  summaryBacklogRef.onSnapshot(doc => {
    if (!doc.exists) {
      summaryBacklogRef.set(makeEmptySummary(), { merge: true });
      return;
    }
    applySummaryToUI("backlog", doc.data());
  });

  function makeEmptySummary() {
    const obj = {};
    SUMMARY_FIELDS.forEach(f => obj[f] = 0);
    return obj;
  }

  function applySummaryToUI(prefix, data) {
    SUMMARY_FIELDS.forEach(name => {
      const el = document.getElementById(prefix + "-" + name);
      if (el) el.value = data[name] ?? 0;
    });
  }

  function saveSummary(which) {
    const prefix = which === "today" ? "today" : "backlog";
    const ref = which === "today" ? summaryTodayRef : summaryBacklogRef;

    const payload = {};
    SUMMARY_FIELDS.forEach(name => {
      const el = document.getElementById(prefix + "-" + name);
      payload[name] = Number(el?.value || 0);
    });

    // ìë™í•©ê³„ ê³„ì‚° (ë°°ë¯¼+ì—­íŒ¬, ì›€ì§¤+ì‚¬ì§„)
    const base_baemin = Number(document.getElementById(prefix + "-ë°°ë¯¼").value || 0);
    const base_yeok   = Number(document.getElementById(prefix + "-ì—­íŒ¬").value || 0);
    const base_um     = Number(document.getElementById(prefix + "-ì›€ì§¤").value || 0);
    const base_sa     = Number(document.getElementById(prefix + "-ì‚¬ì§„").value || 0);

    const sum_baeyeok = base_baemin + base_yeok;
    const sum_umsa    = base_um + base_sa;

    payload["í•©ê³„_ë°°ì—­"] = sum_baeyeok;
    payload["í•©ê³„_ì›€ì‚¬"] = sum_umsa;

    const el1 = document.getElementById(prefix + "-í•©ê³„_ë°°ì—­");
    const el2 = document.getElementById(prefix + "-í•©ê³„_ì›€ì‚¬");
    if (el1) el1.value = sum_baeyeok;
    if (el2) el2.value = sum_umsa;

    payload.updatedAt = new Date().toISOString();

    ref.set(payload, { merge: true })
      .then(() => {
        alert((which === "today" ? "ì˜¤ëŠ˜ ìˆ™ì œ" : "ë°€ë¦° ìˆ™ì œ") + "ë¥¼ ì €ì¥í–ˆì–´ìš”.");
      })
      .catch(err => {
        console.error(err);
        alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
      });
  }

  // ===== ìˆ™ì œ ì¹´ë“œ ì‹¤ì‹œê°„ =====
  cardsRef.orderBy("nickname","asc").onSnapshot(snap => {
    const cards = [];
    snap.forEach(doc => cards.push({ id: doc.id, ...doc.data() }));
    renderCards(cards);
  });

  function addCard() {
    const nickEl = document.getElementById("newNick");
    const idEl   = document.getElementById("newID");
    const nickname = nickEl.value.trim();
    const userid   = idEl.value.trim();
    if (!nickname || !userid) {
      alert("ë‹‰ë„¤ì„ê³¼ ì•„ì´ë””ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      return;
    }

    cardsRef.add({
      nickname,
      userid,
      stats: { ì—­íŒ¬:0, ë°°ë¯¼:0, ì •ì„±:0, ì˜ìƒ:0, ë°©ì…€:0 },
      memo: "",
      balloon: "",
      createdAt: new Date().toISOString()
    }).then(() => {
      nickEl.value = "";
      idEl.value = "";
    }).catch(err => {
      console.error(err);
      alert("ì¹´ë“œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
    });
  }

  function copyUserId(val) {
    if (!val) return;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(val)
        .then(() => alert("ì•„ì´ë””ë¥¼ ë³µì‚¬í–ˆì–´ìš”: " + val))
        .catch(() => alert("ë³µì‚¬ ì¤‘ ë¬¸ì œê°€ ìƒê²¼ì–´ìš”. ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”."));
    } else {
      alert("ìë™ ë³µì‚¬ê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
    }
  }

  function updateCardField(id, field, value) {
    cardsRef.doc(id).update({ [field]: value })
      .catch(err => {
        console.error(err);
        alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
      });
  }

  function updateCardStat(id, statName, value) {
    const num = Number(value || 0);
    cardsRef.doc(id).update({
      ["stats."+statName]: num
    }).catch(err => {
      console.error(err);
      alert("ìˆ«ì ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
    });
  }

  function completeCard(id, nickname) {
    if (!confirm(`${nickname} ì¹´ë“œì˜ ìˆ™ì œë¥¼ ëª¨ë‘ ì™„ë£Œí–ˆë‚˜ìš”?\ní™•ì¸í•˜ë©´ ì´ ì¹´ë“œëŠ” ì‚­ì œë©ë‹ˆë‹¤.`)) return;
    cardsRef.doc(id).delete()
      .catch(err => {
        console.error(err);
        alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
      });
  }

  function renderCards(cards) {
    const container = document.getElementById("cardsContainer");
    container.innerHTML = "";
    if (!cards.length) {
      container.innerHTML = `<div class="empty-text">ì•„ì§ ë“±ë¡ëœ ìˆ™ì œ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }

    cards.forEach(card => {
      const stats = card.stats || {};
      const html = `
        <div class="homework-card">
          <div class="card-header-row">
            <div class="card-name-area">
              <div class="badge-nick">
                ë‹‰ë„¤ì„:
                <input type="text"
                  value="${card.nickname || ""}"
                  style="border:none;background:transparent;width:140px;font-size:13px;"
                  onchange="updateCardField('${card.id}','nickname',this.value)">
              </div>
              <div class="badge-id">
                <span>ì•„ì´ë””: ${card.userid || ""}</span>
                <button type="button" onclick="copyUserId('${card.userid || ""}')">ë³µì‚¬</button>
              </div>
            </div>
            <button class="btn-complete" type="button"
                    onclick="completeCard('${card.id}','${card.nickname || ""}')">
              ì™„ë£Œ <span>ğŸ°</span>
            </button>
          </div>

          <div class="card-stats-grid">
            <div class="card-stat-box">
              <div class="card-stat-label">ì—­íŒ¬</div>
              <input type="number" min="0"
                class="card-stat-input"
                value="${stats.ì—­íŒ¬ ?? 0}"
                onchange="updateCardStat('${card.id}','ì—­íŒ¬',this.value)">
            </div>
            <div class="card-stat-box">
              <div class="card-stat-label">ë°°ë¯¼</div>
              <input type="number" min="0"
                class="card-stat-input"
                value="${stats.ë°°ë¯¼ ?? 0}"
                onchange="updateCardStat('${card.id}','ë°°ë¯¼',this.value)">
            </div>
            <div class="card-stat-box">
              <div class="card-stat-label">ì •ì„±</div>
              <input type="number" min="0"
                class="card-stat-input"
                value="${stats.ì •ì„± ?? 0}"
                onchange="updateCardStat('${card.id}','ì •ì„±',this.value)">
            </div>
            <div class="card-stat-box">
              <div class="card-stat-label">ì˜ìƒ</div>
              <input type="number" min="0"
                class="card-stat-input"
                value="${stats.ì˜ìƒ ?? 0}"
                onchange="updateCardStat('${card.id}','ì˜ìƒ',this.value)">
            </div>

            <div class="card-stat-box full">
              <div class="card-stat-label">ë°©ì…€</div>
              <input type="number" min="0"
                class="card-stat-input"
                value="${stats.ë°©ì…€ ?? 0}"
                onchange="updateCardStat('${card.id}','ë°©ì…€',this.value)">
            </div>
          </div>

          <div class="card-bottom-row">
            <div class="card-bottom-column">
              <div class="card-label-small">ë©”ëª¨</div>
              <textarea
                onchange="updateCardField('${card.id}','memo',this.value)">${card.memo || ""}</textarea>
            </div>
            <div class="card-bottom-column">
              <div class="card-label-small">í’ì„ </div>
              <textarea
                onchange="updateCardField('${card.id}','balloon',this.value)">${card.balloon || ""}</textarea>
            </div>
          </div>
        </div>
      `;
      const wrapper = document.createElement("div");
      wrapper.innerHTML = html;
      container.appendChild(wrapper.firstElementChild);
    });
  }

  // ===== init =====
  setTodayLabel();
</script>

</body>
</html>
