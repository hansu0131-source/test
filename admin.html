<!DOCTYPE html>
<html lang="ko">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    * { box-sizing: border-box; }

    body {
        background: #FFF5E8;
        font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui;
        margin: 0;
        padding: 16px;
        color: #4b3525;
    }

    h1 {
        text-align: center;
        color: #ff8a3c;
        margin: 0 0 6px 0;
        font-size: 22px;
    }

    .tag {
        text-align: center;
        font-size: 12px;
        color: #fff;
        background: #ffb37a;
        padding: 4px 12px;
        border-radius: 999px;
        display: block;
        width: fit-content;
        margin: 0 auto 18px;
    }

    .section-title {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #ff8a3c;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .section-title .sub {
        font-size: 12px;
        font-weight: 400;
        color: #b07b55;
    }

    .card {
        background: #fff;
        padding: 14px;
        border-radius: 14px;
        box-shadow: 0 3px 10px rgba(255, 150, 95, 0.18);
        margin-bottom: 18px;
    }

    textarea {
        width: 100%;
        min-height: 70px;
        border-radius: 10px;
        border: 1px solid #ffcfac;
        padding: 8px;
        resize: vertical;
        font-family: inherit;
        font-size: 13px;
        background: #fffdfa;
    }

    button {
        padding: 8px 14px;
        border: none;
        border-radius: 999px;
        background: #ff8a3c;
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 13px;
    }

    button:active { transform: translateY(1px); }

    .btn-sub {
        background: #ffd9bd;
        color: #945429;
    }

    .btn-danger {
        background: #ffe6db;
        color: #e54a2c;
        font-size: 12px;
    }

    .input-line {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
    }

    .input-line input[type="text"],
    .input-line input[type="number"] {
        flex: 1;
        padding: 7px;
        border-radius: 8px;
        border: 1px solid #ffd1a4;
        font-size: 13px;
        background: #fffdf7;
    }

    .field-pills {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
    }

    .pill {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        border-radius: 999px;
        background: #ffe7d3;
        font-size: 12px;
        gap: 5px;
    }

    .pill button {
        background: none;
        color: #d35425;
        padding: 0 4px;
        font-weight: bold;
        font-size: 12px;
    }

    .space-card {
        margin-bottom: 12px;
        padding: 12px;
        border-radius: 12px;
        background: #fffdf8;
        border: 1px solid #ffe4c9;
        box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        word-break: break-all;
    }

    .badge-nick {
        display: inline-block;
        background: #ffe3c6;
        padding: 5px 12px;
        border-radius: 999px;
        font-size: 14px;
        font-weight: 600;
        color: #8e4e1c;
        margin-bottom: 6px;
    }

    .badge-id {
        background: #fff2e6;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        color: #a55b29;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .badge-id button {
        background: #ffb276;
        padding: 2px 6px;
        font-size: 11px;
        border-radius: 999px;
        color: #fff;
    }

    .space-fields {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin: 8px 0;
    }

    .field-chip {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        padding: 4px 8px;
        background: #fff4e9;
        border-radius: 999px;
    }

    .field-chip input {
        width: 16px;
        height: 16px;
        accent-color: #ff8a3c;
    }

    @media (min-width: 720px) {
        body { max-width: 640px; margin: 0 auto; }
    }
</style>
</head>

<body>

<h1>ğŸ¥• ë‹¹ - ìˆ™ì œ ê´€ë¦¬ì</h1>
<div class="tag">ê´€ë¦¬ì ID: ë‹¹ (ì£¼í™©)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” <span class="sub">(ê´€ë¦¬ì â†” ì‚¬ìš©ì)</span></div>

    <div style="font-size:12px;">ğŸ¥• ê´€ë¦¬ì â†’ ì‚¬ìš©ì</div>
    <textarea id="adminMessage" placeholder="ì‚¬ìš©ìì—ê²Œ ë‚¨ê¸¸ í˜¼ì£ë§ / ìœ„ë¡œ / ë¯¸ì•ˆ / ê²©ë ¤ ë“±ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>

    <div style="text-align:right;margin-top:6px;">
        <button onclick="saveAdminMessage()">ì €ì¥</button>
    </div>

    <div style="height:10px;"></div>

    <div style="font-size:12px;">ğŸ° ì‚¬ìš©ì â†’ ê´€ë¦¬ì</div>
    <div id="userMessageBox"
         style="white-space:pre-line; padding:10px; border-radius:10px; 
                border:1px solid #ffd9c5; background:#fff8f3; min-height:40px;">
        (ì•„ì§ ì‚¬ìš©ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
    </div>
</div>

<!-- ì˜¤ëŠ˜ ìš”ì•½ -->
<div class="card">
    <div class="section-title">ğŸ“Š ì˜¤ëŠ˜ ìˆ™ì œ ìš”ì•½</div>
    <div style="font-size:12px; color:#9c6b41;">â€» ì˜¤ëŠ˜ ê¸°ì¤€ìœ¼ë¡œ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.</div>

    <table style="width:100%; margin-top:10px; font-size:12px; border-collapse:collapse;">
        <tr style="background:#ffe7cf;">
            <th></th><th>ì—­íŒ¬</th><th>ë°©ì…€</th><th>ìˆ™ì œ</th><th>ì‚¬ì§„</th><th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td style="background:#fff5e6;font-weight:600;text-align:center;">ì˜¤ëŠ˜</td>
            <td><input id="today-ì—­íŒ¬"  type="number" min="0" value="0"></td>
            <td><input id="today-ë°©ì…€" type="number" min="0" value="0"></td>
            <td><input id="today-ìˆ™ì œ" type="number" min="0" value="0"></td>
            <td><input id="today-ì‚¬ì§„" type="number" min="0" value="0"></td>
            <td><input id="today-ì›€ì§¤" type="number" min="0" value="0"></td>
        </tr>
    </table>

    <div style="text-align:right;margin-top:8px;">
        <button class="btn-sub" onclick="saveSummaryToday()">ì˜¤ëŠ˜ ì €ì¥</button>
    </div>
</div>

<!-- ëˆ„ì  ìš”ì•½ -->
<div class="card">
    <div class="section-title">ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½</div>
    <div style="font-size:12px;color:#9c6b41;">â€» ì „ì²´ ëˆ„ì ì´ë¯€ë¡œ í•„ìš”í•˜ë©´ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”.</div>

    <table style="width:100%; margin-top:10px; font-size:12px; border-collapse:collapse;">
        <tr style="background:#ffe7cf;">
            <th></th><th>ì—­íŒ¬</th><th>ë°©ì…€</th><th>ìˆ™ì œ</th><th>ì‚¬ì§„</th><th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td style="background:#fff5e6;font-weight:600;text-align:center;">ëˆ„ì </td>
            <td><input id="total-ì—­íŒ¬"  type="number" min="0" value="0"></td>
            <td><input id="total-ë°©ì…€" type="number" min="0" value="0"></td>
            <td><input id="total-ìˆ™ì œ" type="number" min="0" value="0"></td>
            <td><input id="total-ì‚¬ì§„" type="number" min="0" value="0"></td>
            <td><input id="total-ì›€ì§¤" type="number" min="0" value="0"></td>
        </tr>
    </table>

    <div style="text-align:right;margin-top:8px;">
        <button class="btn-sub" onclick="saveSummaryTotal()">ëˆ„ì  ì €ì¥</button>
    </div>
</div>

<!-- ìˆ™ì œ ëŒ€ìƒ ì¶”ê°€ -->
<div class="card">
    <div class="section-title">ğŸ“‹ ìˆ™ì œ ëŒ€ìƒ ì¶”ê°€</div>
    <div style="font-size:12px;color:#9c6b41;">ë‹‰ë„¤ì„ê³¼ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>

    <div class="input-line">
        <input id="newNick" type="text" placeholder="ë‹‰ë„¤ì„" />
        <input id="newID" type="text" placeholder="ì•„ì´ë””" />
        <button onclick="addSpace()">ì¶”ê°€</button>
    </div>
</div>

<!-- í•­ëª©ê´€ë¦¬ -->
<div class="card">
    <div class="section-title">ğŸ“Œ í•­ëª© ê´€ë¦¬</div>
    <div style="font-size:12px;color:#9c6b41;">ì²´í¬í•­ëª©ì„ ì§ì ‘ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

    <div class="input-line">
        <input id="newField" type="text" placeholder="ìƒˆ í•­ëª© ì´ë¦„" />
        <button onclick="addField()">ì¶”ê°€</button>
    </div>

    <div class="field-pills" id="fieldPills"></div>
</div>

<!-- ì¹´ë“œ ëª©ë¡ -->
<div class="card">
    <div class="section-title">ğŸ“¦ ìˆ™ì œ ì¹´ë“œ ëª©ë¡</div>
    <div id="spacesContainer"></div>
</div>

<script>
/* Firebase ì´ˆê¸°í™” */
firebase.initializeApp({
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
});
const db = firebase.firestore();

const todayMessagesRef = db.collection("today").doc("messages");
const summaryTodayRef  = db.collection("summary").doc("today");
const summaryTotalRef  = db.collection("summary").doc("total");
const configRef        = db.collection("config").doc("checklist");
const spacesRef        = db.collection("spaces");

let fields = [];
let spacesData = [];

const statNames = ["ì—­íŒ¬", "ë°©ì…€", "ìˆ™ì œ", "ì‚¬ì§„", "ì›€ì§¤"];
const emptySummary = { "ì—­íŒ¬":0,"ë°©ì…€":0,"ìˆ™ì œ":0,"ì‚¬ì§„":0,"ì›€ì§¤":0 };

/* ì˜¤ëŠ˜ì˜ í•œë§ˆë”” */
todayMessagesRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const d = doc.data();
    document.getElementById("adminMessage").value = d.adminMessage || "";
    document.getElementById("userMessageBox").innerText =
        d.userMessage || "(ì•„ì§ ì‚¬ìš©ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)";
});

/* ê´€ë¦¬ì ë©”ì‹œì§€ ì €ì¥ */
function saveAdminMessage() {
    todayMessagesRef.set({
        adminMessage: document.getElementById("adminMessage").value,
        date: new Date()
    }, { merge:true });
    alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

/* ì˜¤ëŠ˜ ìš”ì•½ */
summaryTodayRef.onSnapshot(doc=>{
    if(!doc.exists) return;
    const d=doc.data();
    statNames.forEach(n=>{
        document.getElementById("today-"+n).value = d[n] ?? 0;
    });
});
function saveSummaryToday(){
    const p={};
    statNames.forEach(n=>{
        p[n]=Number(document.getElementById("today-"+n).value||0);
    });
    summaryTodayRef.set(p,{merge:true});
    alert("ì˜¤ëŠ˜ ìš”ì•½ ì €ì¥");
}

/* ëˆ„ì  ìš”ì•½ */
summaryTotalRef.onSnapshot(doc=>{
    if(!doc.exists) return;
    const d=doc.data();
    statNames.forEach(n=>{
        document.getElementById("total-"+n).value = d[n] ?? 0;
    });
});
function saveSummaryTotal(){
    const p={};
    statNames.forEach(n=>{
        p[n]=Number(document.getElementById("total-"+n).value||0);
    });
    summaryTotalRef.set(p,{merge:true});
    alert("ëˆ„ì  ì €ì¥");
}

/* í•­ëª©ê´€ë¦¬ */
configRef.onSnapshot(doc=>{
    const d=doc.data()||{};
    fields=d.fields||[];
    renderFieldPills();
    renderSpaces();
});
function addField(){
    const f=document.getElementById("newField").value.trim();
    if(!f) return;
    configRef.update({
        fields: firebase.firestore.FieldValue.arrayUnion(f)
    });
    document.getElementById("newField").value="";
}
function deleteField(f){
    configRef.update({
        fields: firebase.firestore.FieldValue.arrayRemove(f)
    });
}

/* í–‰ì¶”ê°€ */
function addSpace(){
    const nk=document.getElementById("newNick").value.trim();
    const id=document.getElementById("newID").value.trim();
    if(!nk||!id){
        alert("ë‹‰ë„¤ì„, ì•„ì´ë”” ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }
    spacesRef.add({ nickname:nk, userid:id, memo:"", checks:{} });
    document.getElementById("newNick").value="";
    document.getElementById("newID").value="";
}

/* í–‰ ì‚­ì œ */
function deleteSpace(id){
    if(confirm("ì‚­ì œí• ê¹Œìš”?")){
        spacesRef.doc(id).delete();
    }
}

spacesRef.onSnapshot(ss=>{
    spacesData=ss.docs.map(d=>({id:d.id,...d.data()}));
    renderSpaces();
});

/* UI ë Œë”ë§ */
function renderFieldPills(){
    const wrap=document.getElementById("fieldPills");
    wrap.innerHTML="";
    fields.forEach(f=>{
        wrap.innerHTML+=`
            <div class="pill">
                <span>${f}</span>
                <button onclick="deleteField('${f}')">Ã—</button>
            </div>`;
    });
}

/* ì²´í¬ ì—…ë°ì´íŠ¸ */
function updateSpaceCheck(id,f,v){
    spacesRef.doc(id).update({ ["checks."+f]:v });
}

/* ê¸°ë³¸ í•„ë“œ ì—…ë°ì´íŠ¸ */
function updateSpaceField(id,f,v){
    spacesRef.doc(id).update({ [f]: v });
}

/* ì•„ì´ë”” ë³µì‚¬ */
function copyUserId(v){
    navigator.clipboard.writeText(v);
    alert("ì•„ì´ë”” ë³µì‚¬ ì™„ë£Œ");
}

/* ì¹´ë“œ ë Œë” */
function renderSpaces(){
    const container=document.getElementById("spacesContainer");
    container.innerHTML="";

    spacesData.forEach(s=>{
        const checks=s.checks||{};
        const card=document.createElement("div");
        card.className="space-card";

        card.innerHTML=`
            <div class="badge-nick">ë‹‰ë„¤ì„: 
                <input value="${s.nickname}" 
                       onchange="updateSpaceField('${s.id}','nickname',this.value)"
                       style="border:none;background:transparent;width:120px;">
            </div>

            <div class="badge-id">
                ${s.userid}
                <button onclick="copyUserId('${s.userid}')">ë³µì‚¬</button>
            </div>

            <div class="space-fields">
                ${fields.map(f=>`
                    <div class="field-chip">
                        <input type="checkbox" 
                               ${checks[f]?"checked":""}
                               onchange="updateSpaceCheck('${s.id}','${f}',this.checked)">
                        <span>${f}</span>
                    </div>
                `).join("")}
            </div>

            <div style="font-size:12px;margin-top:6px;">ë©”ëª¨</div>
            <textarea onchange="updateSpaceField('${s.id}','memo',this.value)">${s.memo||""}</textarea>

            <div style="text-align:right;">
                <button class="btn-danger" onclick="deleteSpace('${s.id}')">í–‰ ì‚­ì œ</button>
            </div>
        `;

        container.appendChild(card);
    });
}
</script>

</body>
</html>
